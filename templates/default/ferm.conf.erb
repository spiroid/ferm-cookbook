# -*- shell-script -*-
#
#  Configuration file for ferm(1).
#  Generated by Chef run for <%= node['fqdn'] %>
#  Please do not modify this file manually directly on the server
#

# Common ipv6 and ipv4 rules
domain (ip ip6) {
    table filter {
        chain INPUT {
            # by default drop everything
            policy DROP;

            # connection tracking
            mod state state INVALID DROP;
            mod state state (ESTABLISHED RELATED) ACCEPT;

            # allow local packet : loopback
            interface lo ACCEPT;

            # respond to ping
            proto icmp ACCEPT;

            # allow SSH connections
            proto tcp dport ssh ACCEPT;

            # logging blocked input traffic 
            mod limit limit 3/min limit-burst 10 LOG log-prefix "Firewall | INPUT | DROPED | " log-level debug;

            # other packets are dropped by the default policy
        }
        chain OUTPUT {
            # by default allow everything
            policy ACCEPT;

            # connection tracking
            #mod state state INVALID DROP;
            mod state state (ESTABLISHED RELATED) ACCEPT;
        }
        chain FORWARD {
            # Not a router, dropping everything
            policy DROP;
        }
    }
}

@include '/etc/ferm/ferm.d/';

